const templateCache = new Map<string, HTMLTemplateElement>();

export function getTemplate(id: string, html: string): HTMLTemplateElement {
  let template = templateCache.get(id);
  if (!template) {
    template = document.createElement('template');
    template.innerHTML = html;
    templateCache.set(id, template);
  }
  return template;
}

export function cloneTemplate(id: string, html: string): DocumentFragment {
  const template = getTemplate(id, html);
  return template.content.cloneNode(true) as DocumentFragment;
}

export const BUTTON_TEMPLATE = `<button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium ring-offset-background transition-all duration-300 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/50 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-40 active:scale-[0.97]"></button>`;

export const PROGRESS_TEMPLATE = `<div class="relative h-3 w-full overflow-hidden rounded-full bg-secondary" role="progressbar"><div class="h-full transition-all duration-500 ease-out rounded-full gradient-accent"></div></div>`;

export const TOAST_TEMPLATE = `<div class="glass glass-border apple-shadow rounded-2xl p-4 animate-fade-in" role="alert"><div class="flex items-start gap-3"><div class="flex-1"><p class="font-semibold text-foreground" data-title></p><p class="text-sm text-muted-foreground mt-1" data-description></p></div><button class="text-muted-foreground hover:text-foreground transition-colors p-1" data-close><svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M1 1L13 13M1 13L13 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button></div></div>`;

export const PROCESSING_STATUS_TEMPLATE = `<div class="w-full max-w-2xl mx-auto glass glass-border apple-shadow rounded-3xl p-10 animate-fade-in" role="region" aria-live="polite"><div class="flex items-center gap-5 mb-8"><div class="w-16 h-16 rounded-2xl bg-primary/15 flex items-center justify-center" data-icon-container></div><div class="flex-1"><h3 class="text-xl font-semibold text-foreground" data-title></h3><p class="text-muted-foreground mt-1" data-step></p></div><div class="text-right" data-counter-container><p class="text-3xl font-mono font-bold text-primary" data-counter></p><p class="text-xs text-muted-foreground" data-counter-label></p></div></div><div class="relative h-3 w-full overflow-hidden rounded-full bg-secondary"><div class="h-full transition-all duration-500 ease-out rounded-full gradient-accent" data-progress-bar></div></div><div class="flex justify-between mt-3 text-xs text-muted-foreground/60 font-mono"><span>0%</span><span class="text-primary font-medium" data-percent></span><span>100%</span></div></div>`;

export const DOWNLOAD_SECTION_TEMPLATE = `<div class="w-full max-w-2xl mx-auto animate-fade-in"><div class="glass glass-border apple-shadow rounded-3xl p-10"><div class="flex items-center justify-between mb-8"><div><h3 class="text-2xl font-semibold text-foreground" data-title></h3><p class="text-muted-foreground mt-1" data-count></p></div><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium gradient-accent text-primary-foreground font-semibold apple-shadow glow-strong hover:scale-[1.02] active:scale-[0.98] h-12 rounded-xl px-8 text-base apple-hover" data-download-all><svg class="w-5 h-5 mr-2" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span data-download-text></span></button></div><div class="grid gap-3 max-h-80 overflow-y-auto pr-2 no-scrollbar" role="list" data-chunk-list></div></div></div>`;

export const CHUNK_ITEM_TEMPLATE = `<div class="flex items-center gap-4 p-5 rounded-2xl bg-secondary/30 border border-border hover:border-muted-foreground/20 hover:bg-secondary/50 transition-all duration-300 group apple-hover" role="listitem"><div class="w-12 h-12 rounded-xl bg-primary/15 flex items-center justify-center"><svg class="w-6 h-6 text-primary" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 11L15 14L10 17V11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div><div class="flex-1 min-w-0"><p class="font-medium text-foreground truncate font-mono text-sm" data-name></p><div class="flex items-center gap-2 text-xs text-muted-foreground mt-1"><svg class="w-3 h-3" width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/><path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span data-time></span></div></div><button class="opacity-0 group-hover:opacity-100 transition-all duration-300 h-9 w-9 rounded-lg inline-flex items-center justify-center text-foreground hover:bg-secondary/50" data-download><svg class="w-4 h-4" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button></div>`;

export const UPLOAD_ZONE_TEMPLATE = `<div class="w-full max-w-2xl mx-auto animate-fade-in"><div class="flex gap-3 mb-8 justify-center" role="tablist" data-tabs></div><div data-error class="mb-6 p-4 rounded-2xl bg-destructive/10 border border-destructive/20 text-destructive text-sm text-center animate-fade-in hidden"></div><div data-upload-area></div></div>`;

export const UPLOAD_DROP_ZONE_TEMPLATE = `<div class="relative border-2 border-dashed rounded-3xl p-16 transition-all duration-300 cursor-pointer group glass border-border hover:border-muted-foreground/30 hover:bg-secondary/20" data-dropzone><input type="file" accept="video/mp4,video/webm,video/quicktime,video/x-msvideo,.mp4,.mov,.avi,.webm" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" data-file-input /><div class="flex flex-col items-center gap-6 text-center"><div class="w-24 h-24 rounded-3xl glass glass-border flex items-center justify-center transition-all duration-300 group-hover:glow-primary group-hover:scale-105" data-icon-container><svg class="w-12 h-12 text-primary" width="24" height="24" viewBox="0 0 24 24" fill="none"><rect x="2" y="2" width="20" height="20" rx="2.18" stroke="currentColor" stroke-width="2"/><path d="M7 2V22" stroke="currentColor" stroke-width="2"/><path d="M17 2V22" stroke="currentColor" stroke-width="2"/><path d="M2 12H22" stroke="currentColor" stroke-width="2"/><path d="M2 7H7" stroke="currentColor" stroke-width="2"/><path d="M2 17H7" stroke="currentColor" stroke-width="2"/><path d="M17 17H22" stroke="currentColor" stroke-width="2"/><path d="M17 7H22" stroke="currentColor" stroke-width="2"/></svg></div><div><p class="text-xl font-semibold text-foreground mb-2" data-title></p><p class="text-muted-foreground" data-subtitle></p></div><p class="text-xs text-muted-foreground/60 px-4 py-2 rounded-full bg-secondary/30" data-formats></p></div></div>`;

export const YOUTUBE_INPUT_TEMPLATE = `<div class="glass glass-border apple-shadow rounded-3xl p-10"><div class="flex flex-col gap-6"><div class="flex items-center gap-4"><div class="w-14 h-14 rounded-2xl bg-destructive/15 flex items-center justify-center"><svg class="w-7 h-7 text-destructive" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10 13C10.4295 13.5741 10.9774 14.0492 11.6066 14.3929C12.2357 14.7367 12.9315 14.9411 13.6467 14.9923C14.3618 15.0435 15.0796 14.9403 15.7513 14.6897C16.4231 14.4392 17.0331 14.047 17.54 13.54L20.54 10.54C21.4508 9.59699 21.9548 8.33397 21.9434 7.02299C21.932 5.71201 21.4061 4.45794 20.4791 3.5309C19.5521 2.60386 18.298 2.07802 16.987 2.06663C15.676 2.05523 14.413 2.55921 13.47 3.47L11.75 5.18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 11C13.5705 10.4259 13.0226 9.95083 12.3934 9.60707C11.7642 9.26331 11.0685 9.05889 10.3533 9.00768C9.63816 8.95646 8.92037 9.05964 8.24861 9.31023C7.57685 9.56082 6.96687 9.953 6.46 10.46L3.46 13.46C2.54921 14.403 2.04524 15.666 2.05663 16.977C2.06802 18.288 2.59387 19.5421 3.52091 20.4691C4.44795 21.3961 5.70201 21.922 7.013 21.9334C8.32398 21.9448 9.58699 21.4408 10.53 20.53L12.24 18.82" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div><div><p class="font-semibold text-foreground text-lg" data-title></p><p class="text-sm text-muted-foreground" data-subtitle></p></div></div><input type="url" placeholder="https://www.youtube.com/watch?v=..." class="w-full h-14 px-5 rounded-2xl bg-secondary/50 border border-border text-foreground placeholder:text-muted-foreground/50 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary/50 font-mono text-sm transition-all duration-300" data-url-input /><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium gradient-accent text-primary-foreground font-semibold apple-shadow glow-strong hover:scale-[1.02] active:scale-[0.98] h-14 rounded-2xl px-10 text-lg font-semibold w-full disabled:pointer-events-none disabled:opacity-40" data-submit disabled><span data-submit-text></span></button></div></div>`;

export function createIconSvg(type: 'loader' | 'scissors' | 'check' | 'alert'): string {
  switch (type) {
    case 'loader':
      return `<svg class="w-8 h-8 text-primary animate-spin" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C15.3137 3 18.1954 4.83685 19.7434 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>`;
    case 'scissors':
      return `<svg class="w-8 h-8 text-primary animate-pulse" width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="6" cy="6" r="3" stroke="currentColor" stroke-width="2"/><circle cx="6" cy="18" r="3" stroke="currentColor" stroke-width="2"/><path d="M20 4L8.12 15.88M14.47 14.48L20 20M8.12 8.12L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    case 'check':
      return `<svg class="w-8 h-8 text-success" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.7649 14.1003 1.98232 16.07 2.85999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    case 'alert':
      return `<svg class="w-8 h-8 text-destructive" width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/><path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    default:
      return '';
  }
}
